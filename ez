-- Tải thư viện Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Tạo cửa sổ chính
local Window = Rayfield:CreateWindow({
   Name = "Multi-hub",
   LoadingTitle = "Loading...",
   LoadingSubtitle = "It can takes few minutes...",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "Multi_Config",
      FileName = "Multi_Settings"
   },
   KeySystem = false,
})

-- Biến toàn cục
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

local ESPEnabled = false
local NoclipEnabled = false
local TeleportIndex = 1
local ESPFolders = {}
local NoclipConnection = nil

-- ==================== HỆ THỐNG NOCLIP ====================
local NoclipLibrary = {}
function NoclipLibrary:ToggleNoclip(value)
    NoclipEnabled = value
    local character = LocalPlayer.Character
    
    if NoclipConnection then
        NoclipConnection:Disconnect()
        NoclipConnection = nil
    end
    
    if value and character then
        NoclipConnection = RunService.Stepped:Connect(function()
            if NoclipEnabled and character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    elseif character then
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
end

-- ==================== HỆ THỐNG ESP ====================
local ESPLibrary = {}
function ESPLibrary:CreateESP(player)
    if player == LocalPlayer then return end
    if ESPFolders[player] then return end
    
    local function setupESP(character)
        if not character then return end
        local highlight = Instance.new("Highlight")
        highlight.Adornee = character
        highlight.Parent = character
        highlight.FillTransparency = 0.4
        highlight.OutlineTransparency = 0.1
        ESPFolders[player] = {highlight}
    end
    
    if player.Character then setupESP(player.Character) end
    player.CharacterAdded:Connect(setupESP)
end
function ESPLibrary:RemoveESP(player)
    if ESPFolders[player] then
        for _, object in pairs(ESPFolders[player]) do
            if object then object:Destroy() end
        end
        ESPFolders[player] = nil
    end
end
function ESPLibrary:ToggleESP(value)
    ESPEnabled = value
    if value then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then self:CreateESP(player) end
        end
    else
        for player in pairs(ESPFolders) do
            self:RemoveESP(player)
        end
    end
end

-- ==================== HỆ THỐNG TELEPORT TỰ ĐỘNG ====================
local TeleportLibrary = {}
function TeleportLibrary:TeleportToNextPlayer()
    local playerList = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart then table.insert(playerList, player) end
        end
    end
    if #playerList == 0 then return end
    if TeleportIndex > #playerList then TeleportIndex = 1 end
    
    local targetPlayer = playerList[TeleportIndex]
    local targetHRP = targetPlayer.Character.HumanoidRootPart
    local localHRP = LocalPlayer.Character and LocalPlayer.Character.HumanoidRootPart
    
    if targetHRP and localHRP then
        localHRP.CFrame = targetHRP.CFrame + Vector3.new(0, 3, 0)
        TeleportIndex = TeleportIndex + 1
    end
end

-- ==================== GIAO DIỆN NGƯỜI DÙNG ====================
local Tab = Window:CreateTab("Công Cụ Chính", "settings")

-- Nút Teleport duy nhất
Tab:CreateButton({
   Name = "TELEPORT",
   Callback = function()
        TeleportLibrary:TeleportToNextPlayer()
   end,
})

-- Toggle cho ESP
Tab:CreateToggle({
   Name = "ESP",
   CurrentValue = false,
   Callback = function(Value)
        ESPLibrary:ToggleESP(Value)
   end,
})

-- Toggle cho Noclip
Tab:CreateToggle({
   Name = "NOCLIP",
   CurrentValue = false,
   Callback = function(Value)
        NoclipLibrary:ToggleNoclip(Value)
   end,
})

-- Xử lý khi respawn để giữ trạng thái Noclip
LocalPlayer.CharacterAdded:Connect(function(character)
    task.wait(1)
    if NoclipEnabled then
        NoclipLibrary:ToggleNoclip(true)
    end
end)

Rayfield:LoadConfiguration()
