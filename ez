-- T·∫£i th∆∞ vi·ªán Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- T·∫°o c·ª≠a s·ªï ch√≠nh
local Window = Rayfield:CreateWindow({
   Name = "TSB Helper - ESP & Teleport",
   Icon = "user", -- S·ª≠ d·ª•ng Lucide icon
   LoadingTitle = "The Strongest Battlegrounds",
   LoadingSubtitle = "ESP & Teleport System Loading...",
   Theme = "Default",
   
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "TSB_Config",
      FileName = "TSB_Settings"
   },
   
   Discord = {
      Enabled = false,
      Invite = "sirius",
      RememberJoins = true
   },
   
   KeySystem = false,
   ToggleUIKeybind = "K"
})

-- Bi·∫øn to√†n c·ª•c
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local ESPEnabled = false
local NoclipEnabled = false
local TeleportIndex = 1
local ESPFolders = {}
local NoclipConnection = nil

-- ==================== ESP SYSTEM ====================
local ESPLibrary = {}

function ESPLibrary:CreateESP(player)
    if player == LocalPlayer then return end
    if ESPFolders[player] then return end
    
    local function setupESP(character)
        if not character or not character:FindFirstChild("HumanoidRootPart") then return end
        
        -- T·∫°o highlight
        local highlight = Instance.new("Highlight")
        highlight.Name = player.Name .. "_ESP"
        highlight.Adornee = character
        highlight.Parent = character
        highlight.FillColor = player.Team == LocalPlayer.Team and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
        highlight.FillTransparency = 0.4
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.OutlineTransparency = 0.1
        
        -- T·∫°o billboard GUI hi·ªÉn th·ªã t√™n
        local billboard = Instance.new("BillboardGui")
        billboard.Name = player.Name .. "_NameTag"
        billboard.Adornee = character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart")
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.MaxDistance = 100
        billboard.Parent = character
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = player.Name
        textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        textLabel.TextSize = 14
        textLabel.Font = Enum.Font.GothamBold
        textLabel.TextStrokeTransparency = 0
        textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        textLabel.Parent = billboard
        
        ESPFolders[player] = {highlight, billboard}
    end
    
    if player.Character then
        setupESP(player.Character)
    end
    
    player.CharacterAdded:Connect(function(character)
        task.wait(1) -- ƒê·ª£i character load ho√†n to√†n
        if ESPEnabled then
            setupESP(character)
        end
    end)
end

function ESPLibrary:RemoveESP(player)
    if ESPFolders[player] then
        for _, object in pairs(ESPFolders[player]) do
            if object then object:Destroy() end
        end
        ESPFolders[player] = nil
    end
end

function ESPLibrary:ToggleESP(value)
    ESPEnabled = value
    if value then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                self:CreateESP(player)
            end
        end
    else
        for player in pairs(ESPFolders) do
            self:RemoveESP(player)
        end
    end
end

-- ==================== NOCLIP SYSTEM ====================
local NoclipLibrary = {}

function NoclipLibrary:ToggleNoclip(value)
    NoclipEnabled = value
    local character = LocalPlayer.Character
    
    if NoclipConnection then
        NoclipConnection:Disconnect()
        NoclipConnection = nil
    end
    
    if value and character then
        NoclipConnection = RunService.Stepped:Connect(function()
            if NoclipEnabled and character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
        
        -- √Åp d·ª•ng ngay l·∫≠p t·ª©c
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    elseif character then
        -- Kh√¥i ph·ª•c collision
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
end

-- ==================== TELEPORT SYSTEM ====================
local TeleportLibrary = {}

function TeleportLibrary:GetPlayerList()
    local playerList = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart then
                table.insert(playerList, player)
            end
        end
    end
    return playerList
end

function TeleportLibrary:TeleportToPlayer(player)
    if not player or not player.Character then return false end
    
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    local localCharacter = LocalPlayer.Character
    local localHumanoidRootPart = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
    
    if not humanoidRootPart or not localHumanoidRootPart then return false end
    
    -- S·ª≠ d·ª•ng TweenService ƒë·ªÉ teleport m∆∞·ª£t m√†
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(localHumanoidRootPart, tweenInfo, {CFrame = humanoidRootPart.CFrame + Vector3.new(0, 3, 0)})
    tween:Play()
    
    return true
end

-- ==================== GUI CREATION ====================

-- Tab ch√≠nh
local MainTab = Window:CreateTab("C√¥ng c·ª• ch√≠nh", "settings")

-- Section ESP
local ESPSection = MainTab:CreateSection("H·ªá th·ªëng ESP")
local ESPToggle = MainTab:CreateToggle({
   Name = "B·∫≠t/T·∫Øt ESP ng∆∞·ªùi ch∆°i",
   CurrentValue = false,
   Flag = "ESPToggle",
   Callback = function(Value)
      ESPLibrary:ToggleESP(Value)
   end,
})

-- Section Noclip
local NoclipSection = MainTab:CreateSection("H·ªá th·ªëng Noclip")
local NoclipToggle = MainTab:CreateToggle({
   Name = "B·∫≠t/T·∫Øt Noclip (ƒêi xuy√™n t∆∞·ªùng)",
   CurrentValue = false,
   Flag = "NoclipToggle",
   Callback = function(Value)
      NoclipLibrary:ToggleNoclip(Value)
   end,
})

MainTab:CreateParagraph({
   Title = "H∆∞·ªõng d·∫´n Noclip", 
   Content = "D√πng ƒë·ªÉ tho√°t ra khi b·ªã k·∫πt trong v·∫≠t th·ªÉ ho·∫∑c t∆∞·ªùng."
})

-- Section Teleport
local TeleportSection = MainTab:CreateSection("H·ªá th·ªëng Teleport")

local PlayerCountLabel = MainTab:CreateLabel("ƒêang t·∫£i...", "users", Color3.fromRGB(255, 255, 255), true)

local TeleportButton = MainTab:CreateButton({
   Name = "üì° Teleport ƒë·∫øn ng∆∞·ªùi ch∆°i ti·∫øp theo",
   Callback = function()
      local playerList = TeleportLibrary:GetPlayerList()
      if #playerList == 0 then return end
      
      if TeleportIndex > #playerList then
         TeleportIndex = 1
      end
      
      local targetPlayer = playerList[TeleportIndex]
      if TeleportLibrary:TeleportToPlayer(targetPlayer) then
         TeleportIndex = TeleportIndex + 1
      end
   end,
})

local ResetTeleportBtn = MainTab:CreateButton({
   Name = "üîÑ Reset danh s√°ch Teleport",
   Callback = function()
      TeleportIndex = 1
   end,
})

local CurrentTargetLabel = MainTab:CreateLabel("Ch∆∞a ch·ªçn ng∆∞·ªùi ch∆°i", "user", Color3.fromRGB(200, 200, 200), true)

-- Tab c√†i ƒë·∫∑t
local SettingsTab = Window:CreateTab("C√†i ƒë·∫∑t", "sliders")

local ESPConfigSection = SettingsTab:CreateSection("C√†i ƒë·∫∑t ESP")
local TeamColorToggle = SettingsTab:CreateToggle({
   Name = "M√†u theo Team (Xanh: ƒë·ªìng ƒë·ªôi, ƒê·ªè: ƒë·ªãch)",
   CurrentValue = true,
   Flag = "TeamColorToggle",
   Callback = function(Value)
      -- C√≥ th·ªÉ th√™m logic c·∫≠p nh·∫≠t m√†u ESP
   end,
})

local TeleportConfigSection = SettingsTab:CreateSection("C√†i ƒë·∫∑t Teleport")
local SafeTeleportToggle = SettingsTab:CreateToggle({
   Name = "Ch·∫ø ƒë·ªô Teleport an to√†n",
   CurrentValue = true,
   Flag = "SafeTeleportToggle",
   Callback = function(Value)
      -- C√≥ th·ªÉ th√™m logic teleport an to√†n
   end,
})

-- ==================== UPDATE SYSTEMS ====================

-- H·ªá th·ªëng c·∫≠p nh·∫≠t th√¥ng tin
local function updatePlayerInfo()
   local playerList = TeleportLibrary:GetPlayerList()
   PlayerCountLabel:Set("S·ªë ng∆∞·ªùi ch∆°i: " .. #playerList)
   
   if #playerList > 0 then
      if TeleportIndex > #playerList then TeleportIndex = 1 end
      local targetPlayer = playerList[TeleportIndex]
      CurrentTargetLabel:Set("Ti·∫øp theo: " .. targetPlayer.Name)
   else
      CurrentTargetLabel:Set("Kh√¥ng c√≥ ng∆∞·ªùi ch∆°i")
   end
end

-- C·∫≠p nh·∫≠t ƒë·ªãnh k·ª≥
coroutine.wrap(function()
   while true do
      task.wait(2)
      updatePlayerInfo()
   end
end)()

-- X·ª≠ l√Ω s·ª± ki·ªán ng∆∞·ªùi ch∆°i
Players.PlayerAdded:Connect(function(player)
   if ESPEnabled then
      task.wait(1)
      ESPLibrary:CreateESP(player)
   end
end)

Players.PlayerRemoving:Connect(function(player)
   ESPLibrary:RemoveESP(player)
end)

-- X·ª≠ l√Ω respawn
LocalPlayer.CharacterAdded:Connect(function(character)
   task.wait(1)
   if NoclipEnabled then
      NoclipLibrary:ToggleNoclip(true)
   end
   if ESPEnabled then
      ESPLibrary:ToggleESP(true)
   end
end)

-- ==================== LOAD CONFIGURATION ====================
Rayfield:LoadConfiguration()

-- Th√¥ng b√°o khi load xong
task.wait(1)
Rayfield:Notify({
   Title = "TSB Helper ƒê√£ S·∫µn S√†ng",
   Content = "ESP, Teleport & Noclip systems activated!",
   Duration = 3,
   Image = "check-circle"
})

print("üéØ TSB Helper loaded successfully!")
